---
title: "Serverlessã§CustomRuntimeã§Crystalå‹•ã‹ã—ã¦ã¿ãŸè©±"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["crystal","AWS","serverless","lambda"]
published: false
---

# ã¾ãˆãŒãã®ã¾ãˆãŒã
ã“ã®è¨˜äº‹ã®åŸ·ç­†ã¯[Custom Runtime](https://dev.classmethod.jp/cloud/aws/lambda-custom-runtime/)ã®å…¬é–‹å‰ã§ã—ãŸ
ãªã®ã§åŸºæœ¬re:Invent2018ä»¥å‰ã®å‰æã§æ›¸ã‹ã‚Œã¦ã¾ã™
ä¸€å¿œCustom Runtimeã«ã¤ã„ã¦ã‚‚è¿½è¨˜ã—ã¦ãŠãã¾ã—ãŸã®ã§ã€Œã†ã‚‹ã›ã‡çµè«–ã ã‘èã‹ã›ã‚ã€ã£ã¦æ–¹ã¯è¿½è¨˜éƒ¨åˆ†ã ã‘ãŠèª­ã¿ãã ã•ã„
ã‚ã¨ãªã‚“ã‹[ã“ã‚“ãªã®ãŒ](https://qiita.com/advent-calendar/2018/lambda-custom-runtimes)ã¨ã‹ã„ã¤ã®é–“ã«ã‹å‡ºæ¥ã¦ã‚‹ã£ã½ã„ã®ã§ã¡ã‚ƒã‚“ã¨ã—ãŸè©±ã‚’èããŸã„äººã¯ãã£ã¡ã«è¡Œã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ï¼ˆæŠ•ã’ã‚„ã‚Šï¼‰

# ä»¥ä¸‹æœ¬æ–‡
ãƒãƒ³ã‚ºãƒ©ãƒœã§ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹å›è·¯([@qazx7412](https://twitter.com/qazx7412))ã§ã™
æ™®æ®µã¯[postfor](https://post-for.com)ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ‹…å½“ã¨ã—ã¦ServerlessFrameworkã‚„AWSã‚„Pythonã¨æ ¼é—˜ã—ãŸã‚Šã€è‡¨æ™‚ã§ä»–ã®ãƒãƒ¼ãƒ ã®ãƒ†ã‚¹ãƒˆã‚’æ‰‹ä¼ã£ãŸã‚Šã—ãŸã‚Šã—ã¦ã¾ã™

ä»Šå›ã¯AWSã§ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§æ´»èºã™ã‚‹Lambdaã«é–¢ã™ã‚‹è©±~~ã§ã™~~ã§ã—ãŸï¼ˆéå»å½¢ï¼‰

## tl;dr
  - nodeã®execç­‰ã‚’ä½¿ã£ã¦å©ã„ã¦ã‚„ã‚Œã°Lambdaã§å¯¾å¿œã—ã¦ã„ãªã„è¨€èªã§å¼·å¼•ã«ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã‚‹
  - [Apex/Up](https://up.docs.apex.sh)ã§ã¯Dockerä¸Šã§Lambdaã§å‹•ãã‚ˆã†ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦Crystalã«å¯¾å¿œã‚’ã—ã¦ã‚‹
  - å‚è€ƒã«ã—ã¦ServerlessFrameworkã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ãŸ
  - ï¼ˆè¿½è¨˜ï¼‰Custom Runtimeã§ã‚‚å‹•ã‹ã—ã¦ã¿ã¾ã—ãŸ
  - ï¼ˆè¿½è¨˜ï¼‰ã¤ã„ã§ã«ServerlessFrameworkã§ãã‚Œã£ã½ãå‹•ã‹ã—ã¦è¦‹ã¾ã—ãŸ

## ã“ã¨ã®å§‹ã¾ã‚Š
æœ€è¿‘ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã®é–‹ç™ºã™ã‚‹é‡ãŒå¢—ãˆã¾ã—ãŸ
ãã‚Œã§è€ƒãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨ãŒã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã©ã†ã‚„ã£ã¦ç„¡æ–™ã§ç¢ºä¿ã™ã‚‹ã‹ã§ã™
æ¥­å‹™ãªã‚‰ã¨ã‚‚ã‹ãå€‹äººãªã‚‰è²¡å¸ƒã®ã“ã¨ã‚’è€ƒãˆã¦ç„¡æ–™ã‹å®Ÿè³ªç„¡æ–™ãã‚‰ã„ã®ã‚³ã‚¹ãƒˆã§æ¸ˆã¾ã›ãŸã„ã§ã™ã­
å®Ÿéš›è‡ªåˆ†ã®å ´åˆã¯GCPã®ç„¡æ–™æ ã®f1-microã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ã€ã¿ã‚“ãªå¤§å¥½ãherokuã®ç„¡æ–™æ ã‚„ã€ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®Arukasã®ç„¡æ–™æ ã§ã‚³ãƒ³ãƒ†ãƒŠãŒä¸€ã¤ç„¡æ–™ã§å‹•ã‹ã›ã‚‹ã®ã¨ã‹ã‚’æ´»ç”¨ã—ã¦ã¾ã™
ã—ã‹ã—æœ¬éŸ³ã¨ã—ã¦ã¯ã¯æ™®æ®µè§¦ã‚Šæ…£ã‚Œã¦ã„ã¦ã‚‹AWSã‚’ä½¿ã„ãŸã„ã¨ã“ã‚ã§ã™
ãã“ã§å‡ºã¦ãã‚‹ã®ãŒLambdaã§ã™
![lambda](https://qiita-image-store.s3.amazonaws.com/0/215879/828f61fe-c441-fd89-47d5-329878a27e1e.png)
*AWS Lambdaã ã‚ˆ*
*ã‚³ãƒ¼ãƒ‰æ›¸ã„ã¦ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã ã‘ã§å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã™ã”ã„ã‚„ã¤ã ã‚ˆ*

è¨€ã‚ãšã¨ã—ã‚ŒãŸAWSã®FaaSã§ã™
é–¢æ•°ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¨ãƒ¡ãƒ¢ãƒªã¨å®Ÿè¡Œæ™‚é–“ã«ã‚ˆã‚‹èª²é‡‘ãªã®ã§å€‹äººã§ã¡ã‚‡ã£ã¨ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå°‘ãªã„æ„Ÿã˜ã®ç‰©ã‚’å‹•ã‹ã™ç¨‹åº¦ãªã‚‰ã°ãŠè²¡å¸ƒã«å„ªã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã§ã™
ã§ã™ãŒã“ã†ã„ã£ãŸFaasï¼ˆã‚„PaaSç­‰ï¼‰ã®å®¿å‘½ã¨ã—ã¦å¯¾å¿œã—ã¦ã„ã‚‹è¨€èªã—ã‹ä½¿ãˆãªã„ã¨ã„ã£ãŸåˆ¶ç´„ãŒã‚ã‚Šã¾ã™

å®Ÿéš›åŸ·ç­†æ™‚ç¾åœ¨ä½¿ãˆã‚‹è¨€èªã¯ã“ã‚“ãªæ„Ÿã˜

```
  - C#ï¼ˆ.NET Core 1.0, 2.0, 2.1ï¼‰
  - Go 1.x
  - Java8
  - Node.js ï¼ˆ6.10, 8.10ï¼‰
  - Pythonï¼ˆ2.7, 3.6, 3.7ï¼‰
  - Ruby 2.5 <- New!!
```

~~Rubyã¨PHPä»¥å¤–ã®ä¸»è¦ãªè¨€èªã«ã¯ãŠãŠã‚ˆãå¯¾å¿œã—ã¦ã‚‹æ„Ÿã˜ã§ã™ã‹ã­ï¼Ÿ~~ Rubyæ¥ã¡ã‚ƒã£ãŸã‚“ã ã‚ˆãªãâ€¦

ã§ã™ãŒç§ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã¯ã“ã‚Œã¾ã§Rubyã‚’ä½¿ã£ã¦æ¥ã¾ã—ãŸã—æœ€è¿‘Crystalã‚’è§¦ã‚Šå§‹ã‚ãŸã®ã§ã“ã‚Œã§é–‹ç™ºã‚’ã—ã¦ã¿ãŸã„æ¬²ãŒã‚ã‚Šã¾ã™
ã§ã™ãŒCrystalã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã‚‚ ~~ãƒã‚¤ãƒŠãƒ¼è¨€èªãªã®ã§~~ Lambdaã§ã¯å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ä½¿ãˆã¾ã›ã‚“
ã§ã‚‚å€‹äººã§ä½¿ã†ãªã‚‰ã‚‚ã£ã¨è‡ªåˆ†ã®å¥½ãã«è¨€èªã‚’é¸ã³ãŸã„â€¦
ãªã®ã§ã©ã†ã«ã‹ã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã¾ã™

## Lambdaã§éå¯¾å¿œãªè¨€èªã‚’å‹•ã‹ã™
å…¬å¼ã§å¯¾å¿œã—ã¦ã„ãªã„è¨€èªã‚’Lambdaã§å‹•ã‹ã™ã«ã¯ã„ãã¤ã‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™
ä¾‹ãˆã°JavaãŒå‹•ãã¨ã„ã†ã“ã¨ã¯JVMè¨€èªãŒå‹•ãã¯ãšãªã®ã§Scalaã‚„Kotlinã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ã‹ã€TypeScriptã‚„CoffeeScriptã€Elmã«Opalã¿ãŸã„ãªAltJSã‚’ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚„ã‚‹ã¨ã‹~~ä»Šæ›´ã‚ã–ã‚ã–CoffeeScriptã¨ã‹ä½¿ã„ãŸã„ã‹ã©ã†ã‹ã¯ã¨ã‚‚ã‹ã~~ã€å¯¾å¿œã—ã¦ã„ã‚‹è¨€èªã‹ã‚‰ä»–ã®è¨€èªã‚’å‘¼ã³å‡ºã™ï¼ˆä¾‹ãˆã°[Python3ã‹ã‚‰rust](https://qiita.com/0ncorhynchus/items/9bc48b4e074bfd6fc689)ã‚’å‘¼ã³å‡ºã—ãŸã‚Šå‡ºæ¥ã‚‹ï¼‰ã¨ã‹[WebAssembly](https://dev.classmethod.jp/cloud/aws/lambda-using-webassembly/)ã¨ã‹ã‚„ã‚Šã‚ˆã†ã¯ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™

ãã—ã¦ã“ã‚Œã‚‰ã®æ‰‹æ®µã«å¯¾å¿œã—ã¦ã„ãªã„ã‚ˆã†ãªè¨€èªã§ã‚‚æœ€çµ‚æ‰‹æ®µãŒã‚ã‚Šã¾ã™
å…ˆç¨‹Lambdaã®ã“ã¨ã‚’ã€Œã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ã„ã„æ„Ÿã˜ã«å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã™ã”ã„ã‚„ã¤ã€ã¿ãŸã„ãªã“ã¨ã‚’æ›¸ãã¾ã—ãŸãŒå³å¯†ã«ã¯ã“ã‚Œã¯æ­£ç¢ºã§ã¯ã‚ã‚Šã¾ã›ã‚“
æ­£ç¢ºã«ã¯ã€Œã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”¨æ„ã—ã¦ãã‚Œã¦å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã™ã”ã„ã‚„ã¤ã€ã§ã™
ä½•å½“ãŸã‚Šå‰ã®ã“ã¨ã‚’è¨€ã£ã¦ã‚‹ã‚“ã ã£ã¦æ„Ÿã˜ã§ã™ãŒå®Ÿéš›ã«ã¯Lambdaã¯ã‚³ãƒ³ãƒ†ãƒŠã®ä¸Šã§å‹•ä½œã—ã¦ã„ã¾ã™
ãªã®ã§Lambdaã«ä½¿ã„ãŸã„è¨€èªã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªç‰©ã‚’å…¨éƒ¨å›ºã‚ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦nodeã®execã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã§ç„¡ç†ã‚„ã‚Šå©ã„ã¦å®Ÿè¡Œã—ã¦ã‚„ã‚Œã°ç†è«–ä¸Šã©ã‚“ãªè¨€èªã§ã‚‚å‹•ä½œã™ã‚‹ã¯ãšã§ã™

ä¾‹ãˆã°Rubyã‚’å‹•ã‹ã™ã“ã¨ã‚’è€ƒãˆã‚‹ãªã‚‰ã€[Traveling Ruby](http://phusion.github.io/traveling-Ruby/)ã‚’çªã£è¾¼ã‚“ã§å®Ÿè¡Œã—ã¦ã‚„ã‚Œã°ç„¡ç†ã‚„ã‚Šã§ã™ãŒã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Rubyã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Rubyã«é–¢ã™ã‚‹è©±ã¯[ã“ã“](https://qiita.com/mii-chan/items/3a9d9f45b2c370372d45)ã‚„[ã“ã“](https://dev.classmethod.jp/cloud/lambda-in-Ruby/)ãªã©ã«ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ï¼‰
å…·ä½“ä¾‹ã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜

```js:handler.js
'use strict';

const exec = require('child_process').exec;

module.exports.hello_crystal = (event, context, callback) => {
  const child = exec('/path/to/ruby ./path/to/script.rb');

  child.stdout.on('data', (result) => {
    callback(null,result);
  });
  child.stderr.on('data', (result) => {
    callback(result);
  });
};
```

ã¾ã¨ã‚ã‚‹ã¨ä»Šå‹•ã‹ã—ãŸã„Crystalã‚’å‹•ã‹ã™ãªã‚‰Lambdaã§å‹•ãã‚ˆã†ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚„ã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãã‚Œã‚’å©ã„ã¦ã‚„ã‚Œã°ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Crystalã§ãã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨ã„ã†ã“ã¨ã§ã™
ãã®ãŸã‚ã«ã¯

  1. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãŸã‚ã®ç’°å¢ƒã‚’ç”¨æ„ã—ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹
  2. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ç·’ã«ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚„ã‚‹

ã“ã¨ãŒå¿…è¦ã§ã™
ãã—ã¦å®Ÿã¯ã“ã®ã‚„ã‚Šæ–¹ã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Crystalã‚’å®Ÿç¾ã—ã¦ã„ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ãŒå­˜åœ¨ã—ã¾ã™


## Apex/Up
Apexã¨åŒã˜ä½œè€…ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç”¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ãŒ[Up](https://up.docs.apex.sh)ã§ã™ï¼ˆ[æ—¥æœ¬èªã§ã®ç´¹ä»‹è¨˜äº‹](https://dev.classmethod.jp/cloud/aws/deploy-serverless-applications-to-aws-with-apex-up/)ï¼‰
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠä½œã‚‹ãŸã‚ã«æ€æƒ³éŒ¯èª¤ã—ã¦ã„ã‚‹æœ€ä¸­ã«å¶ç„¶è¦‹ã¤ã‘ã¾ã—ãŸ
ãªã‚“ã¨[Crystalã«å¯¾å¿œã—ã¦ã„ã¾ã™](https://up.docs.apex.sh/#runtimes.crystal)

ã“ã®Upã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯PaaSã®ã‚ˆã†ã«æ™®é€šã«ä½œã£ãŸAPIã‚„Webã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã®ãŒç‰¹å¾´ã‚‰ã—ã„ã§ã™
æ™®æ®µä½¿ã£ã¦ã„ã‚‹ServerlessFrameworkã¨ã‹ã¯ã©ã¡ã‚‰ã‹ã¨ã„ã†ã¨CFnã®FaaSã«å¯„ã£ãŸå½¢ã§ã®å¼·åŒ–ç‰ˆã¿ãŸã„ãªã‚µãƒ ã‚·ãƒ³ã‚°ã ã£ãŸã®ã§ã¾ã‚‹ã£ãã‚Šæ€æƒ³ãŒé•ã„ã¾ã™ã­

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã¾ã™
ã‚³ãƒ¼ãƒ‰ã¯ã‚µãƒ³ãƒ—ãƒ«ã»ã¼ãã®ã¾ã¾ã§ã™

```up.json
{
  "name": "up-crystal",
  "profile": "<ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å>",
  "regions": [
    "ap-northeast-1"
  ]
}
```

```rb:src/main.cr
require "http/server"

port = ENV["PORT"].to_i

server = HTTP::Server.new(port) do |ctx|
  ctx.response.content_type = "text/plain"
  ctx.response.print "æ–°ãŸãªå…‰ã«ä¼šã„ã«è¡Œã“ã†"
end

server.listen
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚ç°¡å˜ã§ã™

```
$ up

     build: 120 files, 8.3 MB (718ms)
     deploy: version 1 (9.454s)
     stack: complete (22.085s)

```

ãã‚Œã§ã§ããŸAPIGatewayã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å©ã„ã¦ã¿ã¾ã—ã‚‡ã†

```
$ curl https://hagehage.execute-api.ap-northeast-1.amazonaws.com/production/
æ–°ãŸãªå…‰ã«ä¼šã„ã«è¡Œã“ã†
```

æ‹å­æŠœã‘ã™ã‚‹ã»ã©ç°¡å˜ã«å‹•ãã¾ã—ãŸ

ã¨ã‚Šã‚ãˆãšã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§Crystalã™ã‚‹ã¨ã„ã†å½“åˆã®ç›®çš„è‡ªä½“ã¯é”æˆã§ãã¾ã—ãŸ
ã—ã‹ã—å€‹äººçš„ã«ã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãªã‚‰yamlã§ã„ã‚ã„ã‚ãªã‚’å®šç¾©ã—ãŸã„ãªã¨ã„ã†ãŠæ°—æŒã¡ãŒã‚ã‚‹ã®ã§ã“ã‚Œã‚’ServerlessFrameworkã§å‹•ã‹ã™ã“ã¨ã‚’è€ƒãˆã¦ã„ããŸã„ã¨æ€ã„ã¾ã™
ã“ã‚ŒãŒlambdaå‘ã‘ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨ãã®ã‚³ãƒãƒ³ãƒ‰ã®ã‚ˆã†ã§ã™ãŒã€ã“ã‚Œã‚’å‚è€ƒã«ã™ã‚Œã°ä»–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã§ã‚‚å‹•ã‹ã›ã‚‹ã¯ãšã§ã™

```
$ docker run --rm -v $(pwd):/src -w /src tjholowaychuk/up-crystal crystal build --link-flags -static -o server main.cr
```

## ServerlessFramework
ã¨ã„ã†ã“ã¨ã§æœ¬å‘½ã®ServerlessFrameworkã§Crystalã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™
ä»Šå›ã¯å…¥ã£ã¦ããŸJSONã‚’ãã®ã¾ã¾å¸°ã™ã ã‘ã®ç°¡å˜ãªAPIã‚’ä½œã£ã¦ã¿ã¾ã™

```:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
.
â”œ buildfile/
â”‚  â”” main
â”œ src/
â”‚  â”” main.cr
â”œ deploy.sh
â”œ handler.js
â”” serverless.yml
```

nodeã®execã§ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦Crystalã‚’å‘¼ã³å‡ºã—ã¾ã™

```js:handler.js
'use strict';

const exec = require('child_process').exec;

module.exports.hello_crystal = (event, context, callback) => {
  const child = exec(`echo '${JSON.stringify(event)}' | ./buildfile/main`);

  child.stderr.on('data', (result) => {
    callback(JSON.parse(result));
  });
  child.stdout.on('data', (result) => {
    const stdout = result
      .replace(/\"{/g,'{')
      .replace(/}\"/g,'}')
      .replace(/\\\"/g,'"')
      .split('\n')[0];
    callback(null,JSON.parse(stdout));
  });
};
```

```rb:src/main.cr
require "json"

stdin = JSON.parse(STDIN.gets_to_end)

p stdin["body"].to_json
```

æ¨™æº–å…¥åŠ›ã§Lambdaã«æ¸¡ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’Crystalã«ã¶ã¡è¾¼ã‚“ã§åŒã˜ãæ¨™æº–å‡ºåŠ›ã‹ã‚‰çµæœã‚’è¿”ã—ã¦ã‚‚ã‚‰ã£ã¦ã„ã¾ã™
~~ã„ã‚ã„ã‚é›‘ãªã®ã¯è¨±ã—ã¦ã»ã—ã„~~

ã‚ã¨ã¯ã“ã‚Œã‚’ã‚³ãƒ³ãƒ†ãƒŠã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ServerlessFrameworkã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‚„ã‚Œã°ã„ã„ã§ã™ã­
dockerã®æ–¹ã¯Apex/Upã¨åŒã˜ã§ã™ãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å…ƒã¨å…ˆã‚’ãã‚Œãã‚Œ`src/main.cr` ã¨ `buildfile/main` ã«å¤‰æ›´ã—ã¦ã„ã¾ã™
ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã«ã„ã¡ã„ã¡2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä¸¡æ–¹æ‰“ã¤ã®ã¯ã ã‚‹ã„ã®ã§ä»Šå›ã¯ä¸€ã¤ã«ã¾ã¨ã‚ã¦ãŠãã¾ã™

```sh:deploy.sh
docker run --rm -v $(pwd):/src -w /src \
           tjholowaychuk/up-crystal crystal build \
           --link-flags -static -o buildfile/main src/main.cr &&\
sls deploy
```

```serverless.yml
service: serverlesshellocrystal

custom:
  defaultStage: dev
  api_version: v0
  common: common

provider:
  name: aws
  runtime: nodejs8.10
  region: ap-northeast-1
  stage: ${opt:stage, self:custom.defaultStage}
  profile: <ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å>

functions:
  hello_crystal:
    handler: handler.hello_crystal
    events:
      - http:
          path: test
          method: post
          integration: lambda
```

ã¨ã„ã†ã“ã¨ã§æ—©é€Ÿãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¡ã‚ƒã„ã¾ã™

```
$ ./deploy.sh
/opt/crystal/embedded/lib/../lib/libevent.a(evutil.o): In function `test_for_getaddrinfo_hacks':
evutil.c:(.text+0x1488): warning: Using 'getaddrinfo' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/opt/crystal/embedded/lib/../lib/libevent.a(evutil.o): In function `evutil_unparse_protoname':
evutil.c:(.text+0xf0d): warning: Using 'getprotobynumber' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
Serverless: Packaging service...
Serverless: Excluding development dependencies...
Serverless: Uploading CloudFormation file to S3...
Serverless: Uploading artifacts...
Serverless: Uploading service .zip file to S3 (1.96 MB)...
Serverless: Validating template...
Serverless: Updating Stack...
Serverless: Checking Stack update progress...
..............
Serverless: Stack update finished...
Service Information
service: serverlesshellocrystal
stage: dev
region: ap-northeast-1
stack: serverlesshellocrystal-dev
api keys:
  None
endpoints:
  POST - https://hage.execute-api.ap-northeast-1.amazonaws.com/dev/test
functions:
  hello_crystal: serverlesshellocrystal-dev-hello_crystal
Serverless: Removing old service artifacts from S3...
```

ã‚ã¨ã¯ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«postã§ãƒã‚·ãƒã‚·å©ã„ã¦ã‚„ã‚Œã°ã“ã‚Œã§ä»Šåº¦ã“ãLambdaã§CrystalãŒå‹•ãã¯ãšã§ã™ã­

<img width="1153" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2018-11-22 16.59.02.png" src="https://qiita-image-store.s3.amazonaws.com/0/215879/17a5d05c-7674-f6e8-6b59-b33b6a824ecf.png">

å‹•ãã¾ã—ãŸ

## æœ€å¾Œã«
ã¨ã„ã†ã“ã¨ã§ç„¡äº‹Lambdaã§Crystalã‚’å‹•ã‹ã—ã¦ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Crystalã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸ
~~ã§ã‚‚æ­£ç›´å†·é™ã«è€ƒãˆã‚‹ã¨ã“ã‚“ãªã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ°—ã«ã—ãªã„ã‚„ã‚Šæ–¹ãªã‚‰JVMã§å‹•ãScalaã¨ã‹ã„ã‚ã„ã‚å…ˆäººã®çŸ¥è¦‹ãŒã‚ã‚Šãã†ãªRustã¨ã‹ã®ã»ã†ãŒã‚ˆã‹ã£ãŸã®ã§ã¯â€¦ï¼Ÿ~~
ã¾ãTraveling Rubyã‚’å…¥ã‚Œã¦é ‘å¼µã‚‹ã‚ˆã‚Šã¯è‰¯ã„ã¨ã¯æ€ã†ã—RubyãªäººãŒã¡ã‚‡ã£ã¨Lambdaã§ãªã‚“ã‹å‹•ã‹ã—ãŸã„ã¨ã‹ãªã‚‰ä½¿ã£ã¦ã‚‚ã„ã„ã®ã§ã¯ã£ã¦æ°—ã¯ã™ã‚‹
ä»Šå›ã¯ãŸã¾ãŸã¾è‡ªåˆ†ãŒè§¦ã£ã¦ãŸã‹ã‚‰Crystalã‚’é¡Œæã«ã—ã¾ã—ãŸãŒï¼ˆå°‘ãªãã¨ã‚‚Lambdaã§ã¯ï¼‰ä»–ã®éå¯¾å¿œãªè¨€èªã§ã‚‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å‡ºæ¥ã‚‹ã‹ã‚‚ã—ã‚Œãªã„å¯èƒ½æ€§ã¯ã‚ã‚‹ã¨æ€ã†ã®ã§è«¦ã‚ãã‚Œãªã„äººã¯é ‘å¼µã£ã¦ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™
~~ã§ã‚‚æœ¬å½“ã¯å…¬å¼ãŒherokuã®ãƒ“ãƒ«ãƒ‰ãƒ‘ãƒƒã‚¯ã¿ãŸã„ãªä»•çµ„ã¿ã‚’ä½œã£ã¦ãã‚Œã‚‹ã®ãŒä¸€ç•ªãªã‚“ã˜ã‚ƒãªã„ã‹ãªï¼ˆéœ²éª¨ãªè¦æ±‚ï¼‰~~ã¯ãˆãƒ¼ã‚ˆãƒ›ã‚»

# â€¦ã¨ã„ã†è©±ã ã£ãŸã®ã•
ã¨ã„ã†ã®ãŒCustom Runtimeç™ºè¡¨å‰ã®è©±ã ã£ãŸã®ã§ã™
ã§ã‚‚æ¥ã¡ã‚ƒã£ãŸã‚“ã§ã™ã‚ˆã­ã‡â€¦æ‚²ã—ã„ãªã
ãã‚ˆãã‚ˆã—ã¦ã¦ã‚‚ã—ã‚ƒã‚ãªã„ã®ã§Custom Runtimeã§ã‚‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Crystalã‚„ã£ã¦ã¿ã¾ã™
æœ€çµ‚çš„ãªç‰©ã¯[ã“ã¡ã‚‰](https://github.com/limit7412/lambda-crystal-prototype)ã«ç½®ã„ã¦ã‚ã‚Šã¾ã™

## Custom Runtime
ã¾ãš[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/runtimes-walkthrough.html)ã‚’èª­ã‚€é™ã‚ŠCustom Runtimeã§Lambdaã‚’å‹•ã‹ã™å ´åˆã¯ `bootstrap ` ã‚’èµ·ç‚¹ã«ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã§ã™

```:ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®ä¾‹
.
â”œ bootstrap
â”” function.sh
```

```sh:bootstrap
#!/bin/sh

set -euo pipefail

# Initialization - load function handler
source $LAMBDA_TASK_ROOT/"$(echo $_HANDLER | cut -d. -f1).sh"

# Processing
while true
do
  HEADERS="$(mktemp)"
  # Get an event
  EVENT_DATA=$(curl -sS -LD "$HEADERS" -X GET "http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/next")
  REQUEST_ID=$(grep -Fi Lambda-Runtime-Aws-Request-Id "$HEADERS" | tr -d '[:space:]' | cut -d: -f2)

  # Execute the handler function from the script
  RESPONSE=$($(echo "$_HANDLER" | cut -d. -f2) "$EVENT_DATA")

  # Send the response
  curl -X POST "http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/$REQUEST_ID/response"  -d "$RESPONSE"
done
```

ã“ã®bootstrapã¯ã“ã“ã§ã¯bashã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã©ã†ã‚„ã‚‰ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯bashã§ã‚ã‚‹å¿…è¦ã¯ç„¡ã„ã‚ˆã†ã§ã™
ãã—ã¦ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€æ„Ÿã˜ã§ã¯ãƒ«ãƒ¼ãƒ—ã®ä¸­ã§ `http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/next` ã‹ã‚‰å…¥ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’å–å¾—ã—ã¦ `http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/invocation/<ãƒªã‚¯ã‚¨ã‚¹ãƒˆID>/response` ã«è¿”å´ã™ã‚‹å€¤ã‚’å†ã³æ”¾ã‚Šè¾¼ã‚“ã§ä¸Šã’ã‚Œã°å‹•ãã¨ã„ã†ã“ã¨ã®ã‚ˆã†ã§ã™

ã¨ã‚Šã‚ãˆãšLambdaå‘ã‘ã«Crystalã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã¦ã¯ã„ã‚‹ã®ã§åŒã˜ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’Crystalã§æ›¸ã„ã¦ã‚„ã‚Šã¾ã—ã‚‡ã†

```rb:src/main.cr
require "http/client"

while true
  response = HTTP::Client.get "http://#{ENV["AWS_LAMBDA_RUNTIME_API"]}/2018-06-01/runtime/invocation/next"
  event_data = response.body
  request_id = response.headers["Lambda-Runtime-Aws-Request-Id"]

  url : String = "http://#{ENV["AWS_LAMBDA_RUNTIME_API"]}/2018-06-01/runtime/invocation/#{request_id}/response"
  HTTP::Client.post url, body: event_data
end
```

ãã†ã—ãŸã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦zipã§å›ºã‚ã¦ã‚„ã‚Šã¾ã™

```
$ docker run --rm -v $(pwd):/src -w /src tjholowaychuk/up-crystal crystal build --link-flags -static -o bootstrap src/main.cr
$ zip lambda-crystal.zip bootstrap
```

å‡ºæ¥ãŸã‚‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã—ã¦ã‚„ã‚Šã¾ã—ã‚‡ã†
<img width="316" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2018-11-30 14.12.04.png" src="https://qiita-image-store.s3.amazonaws.com/0/215879/66dd1e4c-cf1f-cebe-5634-5f57586ec2e8.png">

ç„¡äº‹å‹•ãã¾ã—ãŸ

## çœŸãƒ»ServerlessFramework
å‹•ã‹ã—ãŸã‘ã©æ‰‹ã§ã„ã¡ã„ã¡zipã§ä¸Šã’ã‚‹ã¨ã‹é¢å€’ãã•ãã¦æ­»ã«ãã†ã«ãªã‚‹ã®ã§ServerlessFrameworkã§ã‚‚ã©ã†ã«ã‹ã—ã¾ã™
æœ€çµ‚çš„ãªç‰©ã¯[ã“ã“](https://github.com/limit7412/serverlesshellocrystal)ã«ãŠã„ã¦ã‚ã‚Šã¾ã™
ä½œã‚‹ã®ã«ã‚ãŸã£ã¦ã¯
ã¨ã„ã†ã‚ã‘ã§ã¾ãšbootstrap

```sh:bootstrap
#!/bin/sh

set -euo pipefail

EXEC="$LAMBDA_TASK_ROOT/buildfile/$_HANDLER"

if [ ! -x "$EXEC" ]; then
    ERROR="{\"errorMessage\" : \"$_HANDLER is not found.\", \"errorType\" : \"HandlerNotFoundException\"}"
    curl -X POST "http://${AWS_LAMBDA_RUNTIME_API}/2018-06-01/runtime/init/error"  -d "$ERROR"
    exit 1
fi

$EXEC
```

[ã“ã¡ã‚‰](https://www.m3tech.blog/entry/aws-lambda-custom-runtime)ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸ
å†…å®¹ã¯åŒã˜ã§ã™ã®ã§ä½•ã‚‚è¨€ã†ã“ã¨ãªã—æ¬¡serverless.yml

```yaml:serverless.yml
service: serverless-crystal-sls

custom:
  defaultStage: dev
  api_version: v0
  common: common

provider:
  name: aws
  runtime: provided
  region: ap-northeast-1
  stage: ${opt:stage, self:custom.defaultStage}
  profile: <ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å>

functions:
  hello:
    handler: hello
    events:
      - http:
          path: test
          method: post
          integration: lambda
```
ä»Šã¾ã§ã®ç‰©ã¨ã»ã¼åŒã˜ã§ã™
ãŸã ä»Šå›ã¯handlerã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
ä¸­ã«å…¥ã£ã¦ã„ã‚‹`main.cr`ãŒå„Lambdaé–¢æ•°ã¨ã„ã†æ„Ÿã˜ã§ã™

```:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
.
â”œ buildfile/
â”‚  â”” hello
â”œ src/
â”‚  â”œ hello
â”‚  â”‚  â”” main.cr
â”‚  â”” runtime
â”‚     â”” handler.cr
â”œ bootstrap
â”œ build.sh
â”œ deploy.sh
â”” serverless.yml
```

ä¸­èº«ã¯ã„ã‚ã„ã‚ã‚¤ãƒã‚¤ãƒã§ã™ãŒãªã‚“ã¨ãªãhandlerã£ã½ãã—ã¾ã—ãŸ
~~contextï¼ŸçŸ¥ã‚‰ãªã„å­ã§ã™ã­â€¦~~

```rb:hello/main.cr
require "./../runtime/handler"

def hello(event)
  event
end

lambda_handler(hello)
```

ãã‚Œã§ã“ã£ã¡ãŒå‘¼ã³å‡ºã—ã¦ã„ã‚‹handlerã®æœ¬ä½“ã§ã™
å‰ã®ä¾‹ã®bootstrapã¨ã»ã¼åŒã˜ã§ã™

```rb:runtime/handler.cr
require "json"
require "http/client"

macro lambda_handler(func)
  module Lambda
    extend self

    def run
      while true
        response = HTTP::Client.get "http://#{ENV["AWS_LAMBDA_RUNTIME_API"]}/2018-06-01/runtime/invocation/next"
        event = JSON.parse(response.body)
        request_id = response.headers["Lambda-Runtime-Aws-Request-Id"]

        body = {{ func }} event["body"]

        url : String = "http://#{ENV["AWS_LAMBDA_RUNTIME_API"]}/2018-06-01/runtime/invocation/#{request_id}/response"
        HTTP::Client.post url, body: body.to_json
      end
    end
  end
end

Lambda.run()
```

ã‚ã¨ã¯`main.cr`ãŒã‚ã‚‹ç‰©ã ã‘ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™

```sh:deploy.sh
stg=$1
[ "$stg" = "" ] && stg="dev"

ls $(pwd)/src/ |
while read line; do
  $(pwd)/build.sh $line || exit 1
done &&
sls deploy -s $stg
```

```sh:build.sh
func=$1
[ -n $func ] || exit 1
# main.crãŒå­˜åœ¨ã™ã‚‹ç‰©ã ã‘ã‚’å¯¾è±¡ã«ã—ãŸã„
[ -f $(pwd)/src/$func/main.cr ] || exit 0

docker run --rm -v $(pwd):/src -w /src \
           tjholowaychuk/up-crystal crystal build \
           --link-flags -static -o buildfile/$func src/$func/main.cr && \
chmod +x src/$func
```

```
$  ./deploy.sh
/usr/lib/gcc/x86_64-linux-gnu/4.8/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup':
(.text+0x11): warning: Using 'dlopen' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
T-C-P-S-ocket.o: In function `initialize':
/opt/crystal/src/socket/tcp_socket.cr:98: warning: Using 'getaddrinfo' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
/opt/crystal/embedded/lib/../lib/libevent.a(evutil.o): In function `evutil_unparse_protoname':
evutil.c:(.text+0xf0d): warning: Using 'getprotobynumber' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking
Serverless: Packaging service...
Serverless: Excluding development dependencies...
Serverless: WARNING: Function hello has timeout of 300 seconds, however, it's attached to API Gateway so it's automatically limited to 30 seconds.
Serverless: Uploading CloudFormation file to S3...
Serverless: Uploading artifacts...
Serverless: Uploading service .zip file to S3 (2.04 MB)...
Serverless: Validating template...
Serverless: Updating Stack...
Serverless: Checking Stack update progress...
..............
Serverless: Stack update finished...
Service Information
service: serverless-crystal-sls
stage: dev
region: ap-northeast-1
stack: serverless-crystal-sls-dev
api keys:
  None
endpoints:
  POST - https://hagehage.execute-api.ap-northeast-1.amazonaws.com/dev/test
functions:
  hello: serverless-crystal-sls-dev-hello
layers:
  None
Serverless: Removing old service artifacts from S3...
```

ãã—ãŸã‚‰ã¾ãŸå‹•ãã‹è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†
<img width="1139" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2018-12-04 17.05.42.png" src="https://qiita-image-store.s3.amazonaws.com/0/215879/06858337-1ced-9ca8-83f7-cceb6afe0595.png">

ã“ã¡ã‚‰ã§ã‚‚ã¡ã‚ƒã‚“ã¨å‹•ãã¾ã—ãŸã­
ï¼ˆã‚ã€ã¡ãªã¿ã«ã“ã‚Œã¯ã‚ãã¾ã§è‡ªåˆ†ç”¨å…¼å˜ã«å‹•ã‹ã—ã¦è¦‹ãŸã‹ã£ãŸäº‹ã«ã‚ˆã‚‹ç”£ç‰©ãªã®ã§ã¡ã‚ƒã‚“ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåŒ–ã—ã¦ã¿ãŸã„ãªã“ã¨ã¯è€ƒãˆã¦ãªã„ã§ã™â€¦ãã†ã„ã†ã®ã¯ã‚‚ã£ã¨å‡ºæ¥ã‚‹äººãŒã‚„ã£ã¦ã©ã†ã

## ã¾ã¨ã‚
ã¨ã„ã†ã‚ã‘ã§Custom Runtimeã§ã‚‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Crystalå‡ºæ¥ã¾ã—ãŸ
å¾…æœ›ã®æ©Ÿèƒ½ãŒæ¥ãŸæ­“å–œã¨çµæ§‹ãªæ™‚é–“ã‚’æ›¸ã‘ã¦æ›¸ã„ãŸè¨˜äº‹ãŒç„¡ã«å¸°ã—ãŸçµ¶æœ›ãŒå…¥ã‚Šæ··ã˜ã£ãŸè¤‡é›‘ãªæ°—åˆ†ã§ã™
æ­£ç›´RubyãŒç„¡ã„å‰æã§æ›¸ã„ãŸã®ã«å¯¾å¿œã—ã¦ã—ã¾ã£ãŸã®ãŒä¸€ç•ªç—›ã‹ã£ãŸâ€¦
ã‚‚ã†ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãªã‚“ã¦äºŒåº¦ã¨æ›¸ãã¾ã›ã‚“ï¼ˆæ–­è¨€ï¼‰

### 2019/12/5è¿½è¨˜
é–‹ç™ºã™ã‚‹ã†ã¡ã«å¤§ããä½œã‚Šã‚’å¤‰ãˆã¦ã—ã¾ã£ãŸã®ã§æ›´æ–°ç‰ˆã‚’æ›¸ãã¾ã—ãŸã€‚
https://qiita.com/qazx7412/items/151b2e9375e63c7a400d