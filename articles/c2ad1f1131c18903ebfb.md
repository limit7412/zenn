---
title: "AWS Lambdaã®Custom Runtimeã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Dartã—ã¦ã¿ãŸ"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Dart","lambda","serverless","AWS"]
published: false
---

æœ€è¿‘Dartã«èˆˆå‘³ã‚’æŒã£ã¦ããŸã®ã§ä»Šå›ã¯Dartã®è©±ã‚’ã—ã¾ã™ã€‚

![dart-logo.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/215879/afb9d019-a457-1bc7-347d-ea0f6f71d20d.png)

ä»Šã¾ã§Dartã¯kotlinã‚„scalaã¨æ¯”ã¹ã¦ã‚¤ã‚±ã¦ãªã„ã¨ã„ã†è©•åˆ¤ã‚’èã„ã¦é£Ÿã‚ãšå«Œã„ã—ã¦ã„ãŸã®ã§ã™ãŒã€Flutterã«æ¡ç”¨ã•ã‚Œã¦ã‹ã‚‰ç››ã‚Šè¿”ã—ã¦ã‚‹ã£ã½ã„ã®ã‚’è¦‹ã¦ãŠç›†ä¼‘ã¿ã§æ™‚é–“ã‚‚ã‚ã‚‹ã—~~ãƒ­ã‚´ã‚‚ã‹ã£ã“ã„ã„ã—~~ã¡ã‚‡ã£ã¨è§¦ã£ã¦è¦‹ã‚ˆã†ã‹ãªã¨æ€ã£ãŸã®ã§Lambdaã§å‹•ãã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

æœ€çµ‚çš„ãªæˆæœç‰©ã¯[ã“ã¡ã‚‰](https://github.com/limit7412/lambda_dart_sls)ã«ãŠã„ã¦ã‚ã‚Šã¾ã™ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã‚‹

ã§ã¯ã¨ã‚Šã‚ãˆãšã“ã®è‡ªä½œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ä½¿ã†ã¨ãã®æµã‚Œã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¿…è¦ãªç‰©ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

  - Dart
  - Serverless Framework
  - docker


ã¾ãš`serverless.yml`ã§ã™ã€‚

```yaml:serverless.yml
service: serverless-dart-sls

custom:
  defaultStage: dev
  api_version: v0

provider:
  name: aws
  runtime: provided
  region: ap-northeast-1
  stage: ${opt:stage, self:custom.defaultStage}

functions:
  hello:
    handler: hello
    events:
      - http:
          path: hello
          method: get
          integration: lambda
  world:
    handler: world
    events:
      - http:
          path: world
          method: post
          integration: lambda
```

Serverless FrameworkãŒã‚ã‹ã‚‹æ–¹ã«ã¯ã»ã¨ã‚“ã©èª¬æ˜ä¸è¦ã ã¨ã¯æ€ã„ã¾ã™ã€‚
ä½¿ã£ãŸã“ã¨ãŒç„¡ã„æ–¹ã¸èª¬æ˜ã‚’ã™ã‚‹ã¨`functions`ãŒLambdaã‚’å®šç¾©ã—ã¦ã„ã‚‹ç®‡æ‰€ã§ã€ãã‚Œãã‚Œ`hello`ã‚’ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¨ã—ã¦getãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’`<url>/hello`ã§å—ã‘ä»˜ã‘ã‚‹Lambdaãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³`hello`ã¨`world`ã‚’ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¨ã—ã¦postãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’`<url>/world`ã§å—ã‘ä»˜ã‘ã‚‹Lambdaãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³`world`ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ¬¡ã«ã“ã“ã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹`hello`ã¨`world`ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
`src/handler`ã®ä¸­ã«ãã‚Œãã‚Œ`hello.dart`ã¨`world.dart`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

```dart:hello.dart
import '../../runtime.dart';

dynamic hello(dynamic event) {
  return {'msg': 'æ–°ãŸãªå…‰ã«ä¼šã„ã«è¡Œã“ã†ã€‚'};
}

void main() {
  lambdaHandler(hello);
}
```

getã«å¯¾ã—ã¦é©å½“ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
`lambdaHandler`ãŒä»Šå›è‡ªä½œã—ãŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§lambdãŒå‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«helloã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```dart:world.dart
import '../../runtime.dart';

dynamic world(dynamic event) {
  final body = event['body'];
  return body;
}

void main() {
  lambdaHandler(world);
}
```

ã“ã¡ã‚‰ã‚‚ã»ã¼åŒã˜ã§ã™ã€‚
postã§å…¥ã£ã¦ããŸbodyã‚’ãã®ã¾ã¾è¿”ã—ã¦ã„ã¾ã™ã€‚

ãã‚Œã§ã¯ã“ã‚Œã‚‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ç°¡å˜ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ã—ã¦ã‚ã‚‹ã®ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
å•é¡Œç„¡ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒå‡ºã¦ãã‚‹ã¯ãšã§ã™ã€‚

```console
$ ./deploy.sh
Password: # ä¸€éƒ¨ã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«sudoãŒå¿…è¦
Resolving dependencies...
Got dependencies!
ï¼ˆç•¥ï¼‰
Serverless: Stack update finished...
Service Information
service: serverless-dart-sls
stage: dev
region: ap-northeast-1
stack: serverless-dart-sls-dev
resources: 16
api keys:
  None
endpoints:
  GET - https://hoge.execute-api.ap-northeast-1.amazonaws.com/dev/hello
  POST - https://hoge.execute-api.ap-northeast-1.amazonaws.com/dev/world
functions:
  hello: serverless-dart-sls-dev-hello
  world: serverless-dart-sls-dev-world
layers:
  None
ï¼ˆç•¥ï¼‰
```

ãã‚Œãã‚Œæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¦ã„ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¸°ã£ã¦ãã‚‹ã¯ãšã§ã™ã€‚

```console
$ curl https://hoge.execute-api.ap-northeast-1.amazonaws.com/dev/hello
{"msg":"æ–°ãŸãªå…‰ã«ä¼šã„ã«è¡Œã“ã†ã€‚"}

$ curl -X POST -H "Content-Type: application/json" -d '[{"name": "å³¶æ‘å¯æœˆ"}, {"name": "æ¸‹è°·å‡›"}, {"name": "æœ¬ç”°æœªå¤®"}]' \
https://hoge.execute-api.ap-northeast-1.amazonaws.com/dev/world
[{"name":"å³¶æ‘å¯æœˆ"},{"name":"æ¸‹è°·å‡›"},{"name":"æœ¬ç”°æœªå¤®"}]
```


## ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚ˆã†
Lambdaã§å‹•ã‹ã™ãŸã‚ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ä¸­èº«ã‚’ã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
ã¾ãšcustom runtimeã§ä»»æ„ã®Lambdaã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªã“ã¨ã¯å¤§ãã2ã¤ã§ã™ã€‚

  - æ‰€å®šã®apiã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’å–å¾—ã—å¾—ãŸæƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ä½•ã‹ã‚’ã—ãŸå¾Œã¾ãŸåˆ¥ã®apiã«å¯¾ã—ã¦çµæœã‚’é€ã‚Šã¤ã‘ã‚‹ç„¡é™ãƒ«ãƒ¼ãƒ—ã®å®Ÿè£…
  - custom runtimeã«è¨­å®šã—ãŸã¨ãã«èµ·å‹•æ™‚ã«æœ€åˆã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«`bootstrap`ã®ç”¨æ„

ã¾ãšç„¡é™ãƒ«ãƒ¼ãƒ—ã®æ–¹ã‹ã‚‰è¦‹ã¦ã„ãã¾ã™ã€‚
ä»Šå›ã¯ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`runtime.dart`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

```dart:runtime.dart
import 'package:http/http.dart' as http;
import 'dart:convert';
import 'dart:io' show Platform;

void lambdaHandler(Function callback) async {
  final api = Platform.environment['AWS_LAMBDA_RUNTIME_API'];

  while (true) {
    final response =
        await http.get('http://${api}/2018-06-01/runtime/invocation/next');

    final event_data = json.decode(utf8.decode(response.bodyBytes));
    final request_id = response.headers['lambda-runtime-aws-request-id'];

    final result = await callback(event_data);

    http.post(
        'http://${api}/2018-06-01/runtime/invocation/${request_id}/response',
        body: json.encode(result));
  }
}
```

ã‚ã¾ã‚Šé›£ã—ã„ã“ã¨ã¯ã—ã¦ã„ã¾ã›ã‚“ãŒä¸€é€šã‚Šè¦‹ã¦ã„ãã¾ã™ã€‚
`http://${Platform.environment['AWS_LAMBDA_RUNTIME_API']}/2018-06-01/runtime/invocation/next`ã‚’å©ãã“ã¨ã§Lambdaã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å„ç¨®æƒ…å ±ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDãŒå–å¾—ã§ãã¾ã™ã€‚
ã“ã‚Œã‚’ã“ã®é–¢æ•°ã®å¼•æ•°ã®callbackã«å‡¦ç†ã‚’ã•ã›ã€ãã®çµæœã‚’ãã®ã¾ã¾`http://${Platform.environment['AWS_LAMBDA_RUNTIME_API']}/2018-06-01/runtime/invocation/${request_id}/response`ã«å¼•ãæ¸¡ã™ã“ã¨ã§çµæœã‚’è¿”å´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¬¡ã«`bootstrap`ã§ã™ã€‚ã‚‚ã—å…ˆç¨‹ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã¾ã¾ã§ã‚ã‚Œã°ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã“ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚

```shell:bootstrap
#!/bin/sh

bin_dir="$LAMBDA_TASK_ROOT/./.aot"
$bin_dir/dartaotruntime $bin_dir/$_HANDLER.dart.aot
```

`.aot`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«aotã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸçµæœã‚’è¨­ç½®ã—ã¦ã‚ã‚ŠlambdaãŒèµ·å‹•ã—ãŸã¨ãã«ãã‚Œã‚’ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã®`bootstrap`ã‚„`.aot`ã®ä¸­èº«ã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã®ã§å…ˆç¨‹ä½¿ç”¨ã—ãŸ`deploy.sh`ãªã®ã§ã™ãŒã€ã“ã®ä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã¾ã™ã€‚

```shell:deploy.sh
#!/bin/bash

stg=$1
[ "$stg" = "" ] && stg="dev"

handler_dir="./src/handler"
bin_dir="./.aot"

rm -rf ./bootstrap $bin_dir
mkdir $bin_dir

cat <<EOF > ./bootstrap
#!/bin/sh

bin_dir="\$LAMBDA_TASK_ROOT/$bin_dir"
\$bin_dir/dartaotruntime \$bin_dir/\$_HANDLER.dart.aot
EOF
chmod +x ./bootstrap || exit 1

docker run --rm -v $(pwd):/work -w /work google/dart cp /usr/lib/dart/bin/dartaotruntime ./.aot
sudo chmod +x $bin_dir/dartaotruntime || exit 1

pub get || exit 1

cat ./serverless.yml |
grep 'handler'       |
awk '{print $2}'     |
while read line; do
    dart2aot $handler_dir/$line.dart $bin_dir/$line.dart.aot || exit 1
done &&
sls deploy -s $stg
```

ä¸€ã¤ãšã¤è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```shell
handler_dir="./src/handler"
bin_dir="./.aot"

rm -rf ./bootstrap $bin_dir
mkdir $bin_dir
```

ã¾ãšã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã‚’ç½®ãå ´æ‰€ã‚„å…ƒã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å ´æ‰€ã‚’è¨­å®šã—ã€å‰å›ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ä½œã£ãŸãƒ•ã‚¡ã‚¤ãƒ«é¡ã‚’æƒé™¤ã—ã¦ã¾ã™ã€‚

```shell
cat <<EOF > ./bootstrap
#!/bin/sh

bin_dir="\$LAMBDA_TASK_ROOT/$bin_dir"
\$bin_dir/dartaotruntime \$bin_dir/\$_HANDLER.dart.aot
EOF
chmod +x ./bootstrap || exit 1
```
å®Ÿè¡Œã«å¿…è¦ãª`bootstrap`ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
åˆ¥ã«bootstrapã¯ã‚ã–ã‚ã–æ¯å›ç”Ÿæˆã™ã‚‹å¿…è¦ã¯æœ¬æ¥ç„¡ã„ã®ã§ã™ãŒã€æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®çµ„ã¿è¾¼ã¿ã‚„ã™ã•ç­‰ã‚’è€ƒãˆã¦ä»Šå›ã¯ã“ã“ã§ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```shell
docker run --rm -v $(pwd):/work -w /work google/dart cp /usr/lib/dart/bin/dartaotruntime ./.aot
sudo chmod +x $bin_dir/dartaotruntime || exit 1

pub get || exit 1
```

ã“ã“ã§dartå´ã®äº‹å‰æº–å‚™ã‚’ã—ã¦ã„ã¾ã™ã€‚
dartã®dokcerã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰linuxå‘ã‘ã®aotã®å®Ÿè¡Œãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã¨ã£ã¦æ¥ã¦ã„ã¾ã™ãŒã“ã‚Œã¯macã‚’è€ƒæ…®ã—ã¦ãã†ã—ã¦ã„ã‚‹ã ã‘ã§linuxãªç’°å¢ƒãªã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚ã‚‹ç‰©ã‚’ãã®ã¾ã¾æŒã£ã¦ãã¦ã‚‚å•é¡Œç„¡ãå‹•ä½œã—ã¾ã™ã€‚
æ­£ç›´ã“ã“ã¯ã‚‚ã£ã¨è‰²ã€…ãªç‰©ã‚’ä¸€ç·’ã«è©°ã‚ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ãªï¼Ÿã£ã¨æ€ã£ã¦ãŸã®ã§ã™ãŒlayerã¨ã‹ã§é ‘å¼µã£ã¦ç”¨æ„ã™ã‚‹å¿…è¦ã‚‚ãªãã‚ã£ã•ã‚Šå‹•ã„ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```shell
cat ./serverless.yml |
grep 'handler'       |
awk '{print $2}'     |
while read line; do
    dart2aot $handler_dir/$line.dart $bin_dir/$line.dart.aot || exit 1
done &&
sls deploy -s $stg
```

æœ€å¾Œã«å„ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã¾ã™ã€‚
grepã‚„awkã§ã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã‚„ã£ã¦ã¾ã™ãŒã“ã‚Œã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æŒ‡å®šã—ã¦ã„ã‚‹åå‰ã‚’å¼•ã£å¼µã‚Šã ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã„ã¾ã™ã€‚

```console
$ cat ./serverless.yml | grep 'handler' | awk '{print $2}'
hello
world
```

ã¾ãŸãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é¸æŠã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å¼•æ•°ã‚’æ¸¡ã—ã¦ã„ã¾ã™ãŒã“ã‚Œã¯ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«æ¸¡ã™å¼•æ•°ã‚’ãã®ã¾ã¾æ¨ªæµã—ã€ç„¡ã„ãªã‚‰`dev`ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```shell
stg=$1
[ "$stg" = "" ] && stg="dev"
```

## Q.ä»•çµ„ã¿ã¨ã‹ã‚ˆãã‚ã‹ã‚“ã­ã‡ã‘ã©ã¨ã‚Šã‚ãˆãšæ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«çµ„ã¿è¾¼ã¿ã¦ã‡ã‚“ã ã‘ã©ã©ã†ã™ã‚Œã°ã„ã„ã®ã•ï¼Ÿ
ãã†ã„ã£ãŸå£°ã«ãŠç­”ãˆã—ã¦ã“ã‚“ãªæ„Ÿã˜ã«ã‚„ã‚Œã°ã„ã„ã‚“ã˜ã‚ƒã­ã£ã¦æ„Ÿã˜ã®æ‰‹é †ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
ãŸã ã—ç­†è€…ã¯Flutterç­‰ã®å®Ÿè·µçš„ãªãƒ•ãƒ­ãƒ³ãƒˆã‚„ã‚¢ãƒ—ãƒªã®Dartã®çµŒé¨“ãŒã‚ã‚‹ã‚ã‘ã§ã¯ç„¡ãã€å‹•ä½œã¯ä¿è¨¼ã—ã‹ã­ã‚‹ã®ã§ã‚ã—ã‹ã‚‰ãšã€‚

##### 1. pubspec.yamlã«httpè¿½è¨˜
```yaml:pubspec.yaml
dependencies:
  http: ^0.12.0+2
```

##### 2. pubspec.yamlåŒã˜éšå±¤ã«serverless.ymlã¨deploy.shã‚’è¨­ç½®
ãŠãã‚‰ãåŒã˜éšå±¤ã«ã‚ã‚Œã°ã„ã‘ã‚‹ã¯ãš

##### 3. ãŠå¥½ããªã¨ã“ã‚ã«runtime.dartã¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç½®ã„ã¦ãŠããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„
`runtime.dart`ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‹ã‚‰èª­ã‚ã‚Œã°è‰¯ã„ã®ã§ãã‚Œãã‚Œã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¨ã£ã¦é©åˆ‡ãªå ´æ‰€ã«ç½®ã„ã¦ãŠã„ã¦ãã ã•ã„ã€‚
ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç½®ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`src/handler`ã¨ã—ã¦ã„ã¾ã™ãŒç°¡å˜ã«å¤‰æ›´å‡ºæ¥ã‚‹ã®ã§ã“ã‚Œã‚‚é©åˆ‡ãªå ´æ‰€ã«ç”¨æ„ã—ã¦ãã ã•ã„ã€‚
ãŸã ã—ã“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ›´ã‚’éšå±¤åˆ†ã‘ã‚‹ã‚ˆã†ãªæ§‹é€ ã«ã¯å¯¾å¿œã—ã¦ã„ãªã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

##### 4. deploy.shã®ä¿®æ­£
ã‚‚ã—3ã§ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç½®ãå ´ç­‰ã‚’å¤‰æ›´ã—ã¦ã„ãŸã‚Šã™ã‚‹å ´åˆã«ã¯ã“ã“ã®å¤‰æ•°ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```shell
handler_dir="./src/handler"
bin_dir="./.aot"
```
`handler_dir`ãŒãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç½®ãå ´ãªã®ã§å¥½ãã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚
ã¾ãŸã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã‚’ç½®ãå ´æ‰€ã‚‚ã“ã“ã§å¤‰æ›´ã§ãã¾ã™ã€‚

##### 5. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
ã“ã‚Œã§å®Ÿè¡Œã™ã‚Œã°ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

```console
$ ./deploy.sh
```

## å®Œèµ°ã—ãŸæ„Ÿæƒ³
ã¨ã„ã†ã“ã¨ã§Dart on Lambdaã§ã—ãŸã€‚
Dartã¯ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒŠãƒªã‚’åãã‚¿ã‚¤ãƒ—ã®è¨€èªã§ã¯ç„¡ã„ã®ã§[Crystal](https://qiita.com/qazx7412/items/5054331183f8655f541c)ãªã©ã«æ¯”ã¹ã¦æ­£ç›´ã‚‚ã£ã¨è‹¦æˆ¦ã™ã‚‹ã¨æ€ã£ã¦ãŸã®ã§ã™ãŒæ€ã„ã®å¤–ã‚ã£ã•ã‚Šå‹•ãã¾ã—ãŸã­ã€‚
ã‚ã¨ä»Šå›å§‹ã‚ã¦Dartã‚’è§¦ã£ã¦ã¿ã¦æ€ã£ãŸã®ã§ã™ãŒã€vscodeã®æ‹¡å¼µã®å‡ºæ¥ãŒã„ã„ã®ã‹æ€ã£ã¦ãŸã‚ˆã‚Šé–‹ç™ºã—ã‚„ã™ã‹ã£ãŸã§ã™ã€‚
ãƒ­ã‚´ãŒå¥½ããªã®ã§è§¦ã£ãŸã ã‘ã ã£ãŸã®ã§å®Ÿç¸¾ã ã‘ä½œã£ã¦çµ‚ã‚ã‚Šã§ã‚‚ã„ã„ã‹ãªã£ã¦æ„Ÿã˜ã§å§‹ã‚ãŸã‘ã©ã“ã‚Œãªã‚‰ã—ã°ã‚‰ãã¯å€‹äººã§é–‹ç™ºã™ã‚‹Lambdaã¯Dartã«ã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­ã€‚


## 2020/1/6è¿½è¨˜
dart2nativeå¯¾å¿œç‰ˆå‡ºã—ã¾ã—ãŸã€‚
https://qiita.com/qazx7412/items/f25781b3b60847e86482

